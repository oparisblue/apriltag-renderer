var u=class{isIdInRange(e){return e>=0&&e<this.maxId}assertIdInRange(e){if(!this.isIdInRange(e))throw new Error(`Invalid ID: ${e}. IDs in AprilTag family ${this.familyName} range from 0 (inclusive) to ${this.maxId} (exclusive).`)}getBitmap(e){return this.assertIdInRange(e),this.layout.render==="simple"?this.getSimpleBitmap(e):this.getRotatedQuadrantsBitmap(e)}getSimpleBitmap(e){let t=[],r=this.layout.codes[e];for(let i=0;i<this.size;i++){let n=[];for(let a=0;a<this.size;a++){let s=this.renderBit(r,this.layout.pattern[i][a]);r=s.code,n.push(s.value)}t.push(n)}return t}getRotatedQuadrantsBitmap(e){let t=this.size,r=this.layout.pattern,i=this.layout.codes[e],n=Array.from({length:t},()=>new Array(t).fill(!1));for(let a=0;a<4;a++){n=this.rotate90(n);for(let s=0;s<=Math.floor(t/2);s++)for(let o=s;o<t-1-s;o++){let l=this.renderBit(i,r[s][o]);i=l.code,n[s][o]=l.value}}if(t%2===1){let a=Math.floor(t/2);n[a][a]=this.renderBit(i,r[a][a]).value}return this.rotate90(n)}rotate90(e){let t=e.length,r=Array.from({length:t},()=>new Array(t));for(let i=0;i<t;i++)for(let n=0;n<t;n++)r[t-1-n][i]=e[i][n];return r}renderBit(e,t){return t==="d"?{code:e<<1n,value:(e&1n<<BigInt(this.layout.bitCount-1))===0n?"b":"w"}:{code:e,value:t}}renderToText(e){return this.getBitmap(e).map(t=>t.map(r=>r==="b"?"\u2588":" ").join("")).join(`
`)}renderToCanvas(e,t,r){let i=r?.position?.x??0,n=r?.position?.y??0,a=r?.position?.size??t.width,s=r?.position?.size??t.height;if(a!==s)throw new Error("Canvas must be square");if(a%this.size!==0)throw new Error(`Canvas size must be a multiple of the tag size (${this.size})`);let o=this.getBitmap(e),f=a/this.size,c=t.getContext("2d");if(!c)throw new Error("Failed to get canvas context");let{blackPath:g,whitePath:d}=this.getPathRects(o,n,i,f);c.fillStyle=r?.blackColor??"black",this.drawPath(g,c),c.fillStyle=r?.whiteColor??"white",this.drawPath(d,c)}getPathRects(e,t,r,i){let n=[],a=[];for(let s=0;s<this.size;s++)for(let o=0;o<this.size;o++){let l={x:r+o*i,y:t+s*i,width:i,height:i};switch(e[s][o]){case"b":n.push(l);break;case"w":a.push(l);break}}return{blackPath:n,whitePath:a}}drawPath(e,t){t.beginPath();for(let r of e)t.rect(r.x,r.y,r.width,r.height);t.fill(),t.closePath()}renderToSvg(e,t){let r=this.getBitmap(e),{blackPath:i,whitePath:n}=this.getPathRects(r,0,0,1),a=t?.blackColor??"#000",s=t?.whiteColor??"#fff",o=this.createSvgPath(i),l=this.createSvgPath(n);return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${this.size} ${this.size}"><path d="${o}" fill="${a}"/><path d="${l}" fill="${s}"/></svg>`}createSvgPath(e){return e.map(({x:t,y:r,width:i,height:n})=>`M${t},${r}v${n}h${i}v${-n}z`).join("")}};function b(h){let e=m(h),t=new DataView(e),r=[];for(let i=0;i<e.byteLength;i+=8)r.push(t.getBigUint64(i,!1));return r}function m(h){if(typeof Buffer<"u"){let r=Buffer.from(h,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let e=atob(h),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t.buffer}function v(h,e,t="simple"){return{pattern:h,bitCount:h.join("").match(/d/g)?.length??0,codes:b(e),render:t}}export{u as a,v as b};
